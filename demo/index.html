<!doctype html>
<html lang="en" class="h-100">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Demo</title>
    <link href="../vendor/twbs/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional: Bootstrap Icons for remove (bi-x) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="bg-dark h-100">
<div class="container bg-white py-5 h-100">
    <h1 class="border-bottom pb-2">$.fn.suggest</h1>
    <form autocomplete="off">
        <div class="row">
            <!-- LEFT: Single select playground -->
            <div class="col-md-6 border-end">
                <div class="p-3">
                    <h4 class="mb-3">Single</h4>
                    <label class="form-label" for="input_select_countries_single">Which European country would you like to travel to?</label>
                    <input id="input_select_countries_single" class="form-control" type="text" name="country_id_single"
                           data-bs-toggle="suggest" autocomplete="false"
                           data-bs-target="./actions.php">
                </div>
                <div class="p-3">
                    <h5>Playground</h5>
                    <div class="mb-3">
                        <label class="form-label" for="selectCountrySingle">Playground: set via method val (single)</label>
                        <select class="form-select border-dark" id="selectCountrySingle">
                        </select>
                    </div>
                </div>
            </div>

            <!-- RIGHT: Multiple select playground -->
            <div class="col-md-6">
                <div class="p-3">
                    <h4 class="mb-3">Multiple</h4>
                    <label class="form-label" for="input_select_countries">Which European countries would you like to travel to?</label>
                    <input id="input_select_countries" class="form-control" type="text" name="country_id[]"
                           data-bs-toggle="suggest" autocomplete="false"
                           data-bs-target="./actions.php">
                </div>
                <div class="p-3">
                    <h5>Playground</h5>
                    <div class="mb-3">
                        <label class="form-label" for="selectCountries">Playground: set via method val (multiple)</label>
                        <select class="form-select border-dark" id="selectCountries" multiple size="12">
                        </select>
                    </div>
                    <div class="mb-2">
                        <span class="text-muted small">Method buttons act on the Multiple instance</span>
                    </div>
                    <button type="button" class="btn btn-outline-dark" id="btn_method_destroy">destroy</button>
                    <button type="button" class="btn btn-outline-dark" id="btn_method_init">init</button>
                    <button type="button" class="btn btn-outline-dark" id="btn_method_refresh">refresh</button>
                    <button type="button" class="btn btn-outline-dark" id="btn_method_updateOptions">updateOptions</button>
                    <button type="button" class="btn btn-outline-dark" id="btn_method_setDisabled">setDisabled</button>
                    <button type="button" class="btn btn-outline-dark" id="btn_method_setBtnClass">setBtnClass</button>
                </div>
            </div>
        </div>
        <div class="p-3">
            <button type="submit" class="btn btn-success">submit</button>
        </div>
    </form>
</div>
<script src="../vendor/components/jquery/jquery.min.js"></script>
<script src="../vendor/twbs/bootstrap/dist/js/bootstrap.bundle.js"></script>
<script src="../dist/jquery.bsSelectSuggest.js"></script>
<script>
    (function ($) {
        $.fn.pageDemo = function () {
            let disabled = false;
            let body = $(this),
                suggestions = {
                    single: '#input_select_countries_single',
                    multiple: '#input_select_countries',
                },
                selects = {
                    single: '#selectCountrySingle',
                    multiple: '#selectCountries'
                },
                buttons = {
                    destroy: '#btn_method_destroy',
                    init: '#btn_method_init',
                    refresh: '#btn_method_refresh',
                    update: '#btn_method_updateOptions',
                    setDisabled: '#btn_method_setDisabled',
                    setBtnClass: '#btn_method_setBtnClass',
                }

            function getCountries() {
                $.getJSON('countries.json', function (json) {
                    // Single select
                    let selectSingle = $(selects.single).empty();
                    $('<option>').appendTo(selectSingle);
                    // Multiple select
                    let selectMulti = $(selects.multiple).empty();
                    $('<option>').appendTo(selectMulti);

                    json.forEach(item => {
                        const opt = $('<option>', { value: item.id, text: item.text });
                        opt.clone().appendTo(selectSingle);
                        opt.clone().appendTo(selectMulti);
                    });

                    // Preselect some values in the playground to mirror demo instances
                    // Single: id 1 (Germany)
                    $(selects.single).val('1').trigger('change.select2_silent');
                    // Multiple: ids 1 and 3
                    $(selects.multiple).val(['1', '3']).trigger('change.select2_silent');
                });
            }

            function events() {
                body
                    // reflect plugin changes (single)
                    .on('change.bs.suggest', suggestions.single, function (e, a/*id*/, b/*text*/) {
                        const value = (a != null ? String(a) : '');
                        $(selects.single).val(value).trigger('change.select2_silent');
                    })
                    // reflect plugin changes (multiple)
                    .on('change.bs.suggest', suggestions.multiple, function (e, a/*ids*/, b/*items*/) {
                        const values = Array.isArray(a) ? a.map(String) : (a != null ? [String(a)] : []);
                        $(selects.multiple).val(values).trigger('change.select2_silent');
                    })
                    .on('submit', 'form', function (e) {
                        e.preventDefault();
                        alert($('form').serialize());
                    })
                    .on('click', buttons.destroy, function () {
                        $(suggestions.multiple).suggest('destroy');
                    })
                    .on('click', buttons.setDisabled, function () {
                        $(suggestions.multiple).suggest('setDisabled', !disabled);
                        disabled = !disabled;
                    })
                    .on('click', buttons.setBtnClass, function () {
                        $(suggestions.multiple).suggest('setBtnClass', 'btn btn-primary btn-sm rounded-0');
                    })
                    .on('click', buttons.update, function () {
                        $(suggestions.multiple).suggest('updateOptions', {
                            btnClass: 'btn btn-danger btn-lg'
                        });
                    })
                    .on('click', buttons.refresh, function () {
                        $(suggestions.multiple).suggest('refresh');
                    })
                    .on('click', buttons.init, function () {
                        initSuggestions();
                    })
                    // when changing the playground select (multiple), push values into the widget
                    .on('change', selects.multiple, function () {
                        const vals = $(this).val() || [];
                        $(suggestions.multiple).suggest('val', vals);
                    })
                    // when changing the playground select (single), push value into the widget
                    .on('change', selects.single, function () {
                        const val = $(this).val();
                        $(suggestions.single).suggest('val', val && val !== '' ? val : null);
                    })
            }

            function initSuggestions() {
                // Single instance
                $(suggestions.single).suggest({
                    debug: true,
                    limit: 25,
                    typingInterval: 400,
                    multiple: false,
                    btnWidth: '400px',
                    btnClass: 'btn btn-secondary shadow',
                    translations: {
                        search: 'Search by country',
                        placeholder: 'Please choose a country',
                        waiting: 'Waiting for typing',
                        typing: 'typing..',
                        loading: 'Loading..',
                        clear: 'Clear',
                        close: 'Close'
                    },
                    showHeaderActionText: false,
                    // Preselect one item (resolved via backend on init)
                    selected: 1,
                    formatItem: null
                });

                // Multiple instance
                $(suggestions.multiple).suggest({
                    debug: true,
                    limit: 25,
                    typingInterval: 400,
                    multiple: true,
                    showMultipleAsList: false,
                    btnWidth: 'fit-content',
                    btnClass: 'btn border rounded-3 rounded-0',
                    translations: {
                        search: 'Search by country',
                        placeholder: 'Please choose a country',
                        waiting: 'Waiting for typing',
                        typing: 'typing..',
                        loading: 'Loading..',
                        clear: 'Clear',
                        close: 'Close'
                    },
                    // Header action labels disabled (icons only)
                    showHeaderActionText: false,
                    // Preselect multiple items (resolved via backend on init)
                    selected: [1, 3]
                });
            }

            function init() {
                initSuggestions();
                getCountries();
                events();
                return body;
            }

            return init();
        }
        $('body').pageDemo();


    }(jQuery));
</script>
</body>
</html>
