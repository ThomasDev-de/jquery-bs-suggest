!function(t){t.fn.suggest=function(e,n){let i=t(this),o,l=null,a=t.extend(!0,{limit:10,darkMenu:!1,btnClass:"btn btn-outline-secondary",emptyText:"Please choose..",waitingForTypingText:"Waiting for typing",typingText:"typing..",loadingText:"Loading.."},e&&"object"==typeof e?e:{}),s=function e(){console.log("LOG: build dropdown");let n=i.closest('[id^="webcito_suggestion_"]');if(n.length)return n;let o="webcito_suggestion_"+t('[id^="webcito_suggestion_"]').length,l=t("<div>",{id:o}).insertAfter(i);return i.hide(),i.appendTo(l),t(`<div class="btn-group w-100 dropdown"><button type="button" class="d-flex align-items-center justify-content-between  ${a.btnClass} dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><span class="js-selected-text">${a.emptyText}</span></button><div class="dropdown-menu ${a.darkMenu?"dropdown-menu-dark":""} p-0 mt-1 w-100"><div class="card border-0 m-0 w-100"><div class="card-header d-flex flex-nowrap align-items-center"><input autocomplete="false" type="search" name="q" class="form-control-sm flex-fill" placeholder="Search"><button role="button" class=" btn-close ms-1 js-webcito-reset"></button></div><div class="card-body p-0"></div><div class="card-footer bg-dark text-bg-dark py-0 px-1 fw-light fst-italic d-flex align-items-center"><small>${a.waitingForTypingText}</small></div></div></div></div>`).insertBefore(i),l}(),d=s.find(".card-body"),r=s.find(".card-footer small"),c=s.find('[type="search"]'),g=e&&"string"==typeof e?e:null;function u(t){r.html(t)}function p(){u(a.loadingText),f()}function f(e=!0,n){null!==l&&(l.abort(),l=null);let o=e?{q:c.val()||null,limit:a.limit}:{value:n};l=t.get(i.data("bsTarget"),o,function(n){n.error?i.trigger("suggest-error",[n.error]):e?(d.empty(),n.items.forEach(e=>{t("<div>",{html:`<a class="dropdown-item" href="#${e.id}">${e.text}</a>`}).appendTo(d).find("a").data("item",e)}),n.items.length!==n.total?u(`<span class="badge bg-danger">Achtung, es werden nur ${n.items.length} von ${n.total} Ergebnissen angezeigt</span>`):u("Results: "+n.items.length)):(i.val(n.id),m(n.text))})}function m(t){s.find(".js-selected-text").html(t||a.emptyText)}return!0!==i.data("init")&&(c.on("keyup",function(){clearTimeout(o),o=setTimeout(p,400)}),c.on("keydown",function(){clearTimeout(o),u(a.typingText)}),s.on("click","a.dropdown-item",function(e){e.preventDefault();let n=t(e.currentTarget),o=n.data();i.trigger("suggest-change",[o.id,o.text]);let l=n.attr("href").substring(1);i.val(l),m(n.html())}).on("click",".js-webcito-reset",function(t){t.preventDefault(),i.val(null),c.val(null),d.empty(),m(),u(a.waitingForTypingText)}).on("hidden.bs.dropdown",".dropdown",function(){d.empty(),c.val(null),u("Warte auf Eingabe")}).on("shown.bs.dropdown",".dropdown",function(){c.focus()}),i.data("init",!0)),null!==g&&"val"===g.toLowerCase()&&(i.val(null),c.val(null),d.empty(),m(),u(a.waitingForTypingText),f(!1,n)),i}}(jQuery);